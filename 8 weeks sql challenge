Case Study Questions
   --------------------*/

-- 1. What is the total amount each customer spent at the restaurant?
SELECT
  	s.customer_id,
    sum(m.price) as amount
FROM dannys_diner.sales as s
join dannys_diner.menu as m
on s.product_id = m.product_id
group by customer_id
ORDER BY customer_id;



-- 2. How many days has each customer visited the restaurant?
SELECT
  	customer_id,
    count(order_date)
FROM dannys_diner.sales
group by customer_id
ORDER BY customer_id;

-- 3. What was the first item from the menu purchased by each customer?
with sales_cte as (
  select customer_id, product_name,
  dense_rank() over(partition by s.customer_id order by s.order_date) as dns_rnk
  FROM dannys_diner.sales as s
  join dannys_diner.menu as m
  on s.product_id = m.product_id)
  
  select customer_id,product_name
  from sales_cte
  where dns_rnk = 1
  group by customer_id, product_name;
